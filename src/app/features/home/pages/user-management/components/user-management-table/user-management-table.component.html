<div class="max-w-full overflow-x-auto">

    <div *ngIf="loading$ | async" class="p-4 text-center">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto"></div>
        <p class="mt-2">Loading...</p>
    </div>


    <div *ngIf="activeTab === 'users' && !(loading$ | async) && !(error$ | async)">

        <div class="hidden md:grid grid-cols-6 gap-4 px-4 py-7 font-medium text-sm md:text-base">
            <div>User</div>
            <div>Online Status</div>
            <div>Email/Phone</div>
            <div>Role</div>
            <div>Teams</div>
            <div>Actions</div>
        </div>
        <hr class="border-gray-200">

        <div *ngFor="let user of users$ | async"
            class="hidden md:grid grid-cols-6 gap-4 px-4 py-4 items-center text-sm md:text-base hover:bg-gray-50">

            <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center">
                    {{ user.first_name[0] }}{{ user.last_name[0] }}
                </div>
                <span>{{ user.first_name }} {{ user.last_name }}</span>
            </div>
            <div>
                <span class="w-3 h-3 rounded-full inline-block"
                    [ngClass]="user.online_status ? 'bg-green-500' : 'bg-gray-400'"></span>
            </div>
            <div class="flex flex-col">
                <span>{{ user.email }}</span>
                <span class="text-gray-500 text-sm">{{ user.phone_number }}</span>
            </div>
            <div>
                <span *ngFor="let role of user.roles" class="mr-1">
                    {{ role.role_name }}
                </span>
            </div>
            <div>
                <span *ngFor="let team of user.teams" class="mr-1">
                    {{ team.name }}
                </span>
            </div>
            <div>
                <app-user-actions-dropdown [user]="user" (edit)="editUserClick($event)"></app-user-actions-dropdown>
            </div>
        </div>

        <div class="md:hidden space-y-4 p-4">
            <div *ngFor="let user of users$ | async" class="bg-white p-4 rounded-lg shadow-sm border border-gray-100">
                <div class="flex justify-between items-start">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center">
                            {{ user.first_name[0] }}{{ user.last_name[0] }}
                        </div>
                        <div>
                            <p class="font-medium">{{ user.first_name }} {{ user.last_name }}</p>
                            <div class="flex items-center gap-1 text-sm">
                                <span class="w-2 h-2 rounded-full block"
                                    [ngClass]="user.online_status ? 'bg-green-500' : 'bg-gray-400'"></span>
                                <span>{{ user.online_status ? 'Online' : 'Offline' }}</span>
                            </div>
                        </div>
                    </div>
                    <app-user-actions-dropdown [user]="user" (edit)="editUserClick($event)"></app-user-actions-dropdown>
                </div>

                <div class="mt-4 space-y-2 text-sm">
                    <div>
                        <p class="text-gray-600">Contact</p>
                        <p>{{ user.email }}</p>
                        <p class="text-gray-500">{{ user.phone_number }}</p>
                    </div>
                    <div>
                        <p class="text-gray-600">Roles</p>
                        <div class="flex flex-wrap gap-1">
                            <span *ngFor="let role of user.roles" class="bg-gray-100 px-2 py-1 rounded text-sm">
                                {{ role.role_name }}
                            </span>
                        </div>
                    </div>
                    <div>
                        <p class="text-gray-600">Teams</p>
                        <div class="flex flex-wrap gap-1">
                            <span *ngFor="let team of user.teams" class="bg-blue-100 px-2 py-1 rounded text-sm">
                                {{ team.name }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Teams Tab Content -->
    <div *ngIf="activeTab === 'teams' && !(loading$ | async) && !(error$ | async)">
        <!-- Desktop View -->
        <div class="hidden md:grid grid-cols-4 gap-4 px-4 py-7 font-medium text-sm md:text-base">
            <div>Team Name</div>
            <div>Default Team</div>
            <div>Team Size</div>
            <div>Actions</div>
        </div>
        <hr class="border-gray-200">

        <div *ngFor="let team of teams$ | async"
            class="hidden md:grid grid-cols-4 gap-4 px-4 py-4 items-center text-sm md:text-base">
            <div>{{ team.name }}</div>
            <div>_</div>
            <div>{{ team.users.length }} members</div>
            <div class="flex gap-2">
                <button (click)="editTeamClick(team)" class="text-blue-500 hover:text-blue-700">Edit</button>
                <button (click)="teamDeleteDialogHandler(team.name)"
                    class="text-red-500 hover:text-red-700">Delete</button>
            </div>
        </div>

        <!-- Mobile View -->
        <div class="md:hidden space-y-4 p-4">
            <div *ngFor="let team of teams$ | async" class="bg-white p-4 rounded-lg shadow-sm border border-gray-100">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="font-medium">{{ team.name }}</p>
                        <p class="text-sm text-gray-500">{{ team.users.length }} members</p>
                    </div>
                    <div class="flex gap-2">
                        <button (click)="editTeamClick(team)" class="text-blue-500 hover:text-blue-700 text-sm">Edit</button>
                        <button (click)="teamDeleteDialogHandler(team.name)"
                            class="text-red-500 hover:text-red-700 text-sm">Delete</button>
                    </div>
                </div>
                <div class="mt-2 text-sm">
                    <p class="text-gray-600">Default Team</p>
                    <p>_</p>
                </div>
            </div>
        </div>
    </div>
</div>


<ng-container *ngIf="(activeTab === 'users' ? usersPagination$ : teamsPagination$) | async as pagination">
    <app-pagination [currentPage]="pagination.page" [totalPages]="pagination.total_pages"
        [totalCount]="pagination.total_count" [limit]="currentLimit" (pageChange)="handlePageChange($event)"
        (limitChange)="handleLimitChange($event)">
    </app-pagination>
</ng-container>
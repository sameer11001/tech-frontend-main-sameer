<div
  class="node-card bg-white rounded-lg shadow-lg p-4 border border-gray-200 cursor-grab active:cursor-grabbing select-none relative will-change-transform transition-shadow duration-200 hover:shadow-xl"
  [class.dragging]="isDragging"
  [class.no-transition]="isDragging"
  (mousedown)="onMouseDown($event)"
  (touchstart)="onTouchStart($event)"
>
  <app-connection-button (connectionStart)="onConnectionStart.emit($event)">
  </app-connection-button>

  <app-node-header
    [title]="node.title || 'Question'"
    icon="question_answer"
    color="green"
    (addNode)="onAddNode.emit()"
    (delete)="onDelete.emit()"
  >
  </app-node-header>

  <form [formGroup]="questionForm" class="space-y-4">
    <!-- Question Text Field -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1"
        >Question Text</label
      >
      <textarea
        formControlName="questionText"
        placeholder="Enter your question here..."
        class="w-full p-3 border border-gray-300 rounded-lg text-sm resize-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
        rows="3"
      >
      </textarea>
    </div>

    <!-- Answer Type Selection -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2"
        >Answer Type</label
      >
      <select
        formControlName="answerVariant"
        class="w-full p-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent"
      >
        <option *ngFor="let option of answerTypeOptions" [value]="option.value">
          {{ option.label }}
        </option>
      </select>
    </div>

    <!-- Save Answer in Variable -->
    <div class="space-y-3">
      <div class="flex items-center gap-2">
        <input
          type="checkbox"
          [id]="'saveAnswer_' + node.id"
          formControlName="saveToVariable"
          class="w-4 h-4 text-green-600 rounded focus:ring-green-500"
        />
        <label
          [for]="'saveAnswer_' + node.id"
          class="text-sm font-medium text-gray-700"
        >
          Save answer in variable
        </label>
      </div>

      <!-- Variable Name Input -->
      <div *ngIf="questionForm.get('saveToVariable')?.value" class="ml-6">
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Variable Name</label
        >
        <input
          type="text"
          formControlName="variableName"
          placeholder="e.g., user_name, user_email"
          class="w-full p-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent"
        />
        <p class="text-xs text-gray-500 mt-1">
          Use this variable in future messages:
          {{ questionForm.get("variableName")?.value || "variable_name" }}
        </p>
      </div>
    </div>

    <!-- Accept Media Response -->
    <div class="flex items-center gap-2">
      <input
        type="checkbox"
        [id]="'acceptMedia_' + node.id"
        formControlName="acceptMediaResponse"
        class="w-4 h-4 text-green-600 rounded focus:ring-green-500"
      />
      <label
        [for]="'acceptMedia_' + node.id"
        class="text-sm font-medium text-gray-700"
      >
        Accept media response (images, documents)
      </label>
    </div>

    <!-- Question Preview -->
    <app-question-preview
      [questionText]="
        questionForm.get('questionText')?.value ||
        'Enter your question above to see preview...'
      "
      [answerType]="questionForm.get('answerVariant')?.value || ''"
      [variableName]="questionForm.get('variableName')?.value || ''"
    >
    </app-question-preview>
  </form>
</div>
